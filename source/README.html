
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>SIPEC &#8212; SIPEC  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SwissKnife package" href="SwissKnife.html" />
    <link rel="prev" title="Welcome to SIPEC’s documentation!" href="../index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="sipec">
<h1>SIPEC<a class="headerlink" href="#sipec" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://github.com/psf/black"><img alt="Code style: black" src="https://img.shields.io/badge/code%20style-black-000000.svg" /></a></p>
<p>SIPEC: the deep-learning Swiss knife for behavioral data analysis</p>
<p>This is the repository accompanying the <a class="reference external" href="https://doi.org/10.1101/2020.10.26.355115">SIPEC
publication*</a>, which is a
pipeline that enables all-round behavioral analysis through the usage of
state-of-the-art neural networks. You can use SIPEC by either combining
its modules in your own workflow, or using template workflows, that have
been used in the paper, which can be accessed via command line. We will
be providing more detailed and illustrated instructions soon. Moreover,
extensive documentation and more exemplary data will be made available.</p>
<p>We welcome feedback via GitHub issues.</p>
<ul class="simple">
<li><p>Markus Marks, Jin Qiuhan, Oliver Sturman, Lukas von Ziegler, Sepp
Kollmorgen, Wolfger von der Behrens, Valerio Mante, Johannes Bohacek,
Mehmet Fatih Yanik bioRxiv 2020.10.26.355115; doi:
<a class="reference external" href="https://doi.org/10.1101/2020.10.26.355115">https://doi.org/10.1101/2020.10.26.355115</a></p></li>
</ul>
<p><img alt="image1" src="source/supp_files/Supplementary%20Video%201.gif" /></p>
<section id="usage-installation">
<h2>Usage/Installation<a class="headerlink" href="#usage-installation" title="Permalink to this headline">¶</a></h2>
<p><strong>For using SIPEC, your machine should have a powerful GPU. We have
tested the scripts with NVIDIA GTX 1080, NVIDIA GTX 2080 Ti and V100
GPUs.</strong></p>
<section id="docker">
<h3>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h3>
<p>We provide a docker image with the required environment to run the SIPEC
scripts.</p>
<p>In order to pull the docker image you would first need to install
<code class="docutils literal notranslate"><span class="pre">docker</span></code> and <code class="docutils literal notranslate"><span class="pre">nvidia-docker2</span></code> following the instructions on:</p>
<blockquote>
<div><p><a class="reference external" href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html">https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html</a></p>
</div></blockquote>
<p>After installing <code class="docutils literal notranslate"><span class="pre">docker</span></code> and <code class="docutils literal notranslate"><span class="pre">nvidia-docker2</span></code> you can download the
SIPEC image by executing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">sipec</span><span class="o">/</span><span class="n">sipec</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
<p><strong>Note:</strong> In order to run docker without <code class="docutils literal notranslate"><span class="pre">sudo</span></code> you would need to
create a docker group and add your user to it. Please follow the
instructions on:
<a class="reference external" href="https://docs.docker.com/engine/install/linux-postinstall/">https://docs.docker.com/engine/install/linux-postinstall/</a></p>
<p>The docker image contains the environment, sample data and SIPEC
scripts.</p>
</section>
<section id="environment-installation">
<h3>Environment installation<a class="headerlink" href="#environment-installation" title="Permalink to this headline">¶</a></h3>
<p>If you do not want to use the docker container you can follow these
installation instructions for <strong>Linux</strong>. These instructions have been
tested on Ubuntu 20.04 but would most likely also work on Ubuntu 18.</p>
<section id="step-1-install-cuda-11-0-3">
<h4>Step 1: Install Cuda 11.0.3<a class="headerlink" href="#step-1-install-cuda-11-0-3" title="Permalink to this headline">¶</a></h4>
<p>Download and install Cuda 11.0.3 (We have tested the setup with this
cuda version).</p>
<p>After the installation is finised run <code class="docutils literal notranslate"><span class="pre">nvcc</span> <span class="pre">--version</span></code> to check the
installed cuda version.</p>
</section>
<section id="step-2-install-cudnn-8">
<h4>Step 2: Install cuDNN 8<a class="headerlink" href="#step-2-install-cudnn-8" title="Permalink to this headline">¶</a></h4>
<p>Download and install cuDNN 8. For this you would need to register for
NVIDIA’s developer program (it is free):</p>
<p><a class="reference external" href="https://developer.nvidia.com/cudnn-download-survey">https://developer.nvidia.com/cudnn-download-survey</a></p>
</section>
<section id="step-3">
<h4>Step 3:<a class="headerlink" href="#step-3" title="Permalink to this headline">¶</a></h4>
<p>After you have successfully installed cuda and cuDNN: * clone the SIPEC
repository * open a terminal and go to the cloned SIPEC directory:
<code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">PATH_TO_SIPEC_ON_YOUR_MACHINE</span></code> * run the following commands</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">setup</span><span class="o">.</span><span class="n">sh</span>
<span class="o">./</span><span class="n">setup</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>The script will ask you for the root password.</p>
</section>
<section id="step-4">
<h4>Step 4:<a class="headerlink" href="#step-4" title="Permalink to this headline">¶</a></h4>
<p>The script <code class="docutils literal notranslate"><span class="pre">setup.sh</span></code> has created a virtual environment named <code class="docutils literal notranslate"><span class="pre">env</span></code>
in the repository folder. Activate the environment by executing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">./</span><span class="n">env</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
</section>
<section id="step-5">
<h4>Step 5:<a class="headerlink" href="#step-5" title="Permalink to this headline">¶</a></h4>
<p>To test your setup run one of the scripts in the folder <code class="docutils literal notranslate"><span class="pre">SwissKnife</span></code>,
e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<section id="predefined-pipelines">
<h3>predefined pipelines<a class="headerlink" href="#predefined-pipelines" title="Permalink to this headline">¶</a></h3>
<p>You can run these template pipelines for training or evaluation of SIPEC
networks.</p>
<p>If your system has multiple GPUs, the <code class="docutils literal notranslate"><span class="pre">--gpu</span></code> flag allows you to run a
script on a specific GPU while keeping other GPUs free to run other
scripts.</p>
<p>Here are some example command line usages of the pipeline</p>
<pre><code>
docker run -v "<b>RESULTS_PATH</b>:/home/user/results" --runtime=nvidia --rm sipec/sipec
                      segmentation.py --cv_folds 0 --gpu 0 --frames /home/user/data/mouse_segmentation_4plex_merged/frames --annotations /home/user/data/mouse_segmentation_4plex_merged/merged.json

docker run -v "<b>RESULTS_PATH</b>:/home/user/results" --runtime=nvidia --rm sipec/sipec
                     classification_comparison.py --gpu 0 --config_name behavior_config_final --random_seed 1 --output_path=/home/user/results

docker run -v "<b>RESULTS_PATH</b>:/home/user/results" --runtime=nvidia --rm sipec/sipec
                      poseestimation.py --gpu 0 --results_sink /home/user/results --dlc_path /home/user/data/mouse_pose/OFT/labeled-data/ --segnet_path /home/user/data/pretrained_networks/mask_rcnn_mouse_0095.h5 --config poseestimation_config_test

docker run -v "<b>RESULTS_PATH</b>:/home/user/results" --runtime=nvidia --rm sipec/sipec
                      full_inference.py --gpu 0 --species mouse --video /home/user/data/full_inference_posenet_25_June/animal1234_day1.avi --posenet_path /home/user/data/pretrained_networks/posenet_mouse.h5  --segnet_path /home/user/data/pretrained_networks/mask_rcnn_mouse_0095.h5 --max_ids 4 --results_sink /home/user/results/full_inference

<b>Coming soon</b>: behavior.py

</pre><p>Where, <strong>RESULTS_PATH</strong> is the path on your machine where you would like
to write the results.</p>
<p>The output of these workflows are results files that quantify the
network performance, and a .h5 file that are the network weights for
subsequent use. Depending on modules to be trained, and the GPUs
available the training can take multiple hours or days.</p>
<p>In order to find all the arguments that can be passed to the scripts use
the flag <code class="docutils literal notranslate"><span class="pre">--help</span></code>, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">container</span> <span class="n">run</span> <span class="o">--</span><span class="n">runtime</span><span class="o">=</span><span class="n">nvidia</span> <span class="o">--</span><span class="n">rm</span> <span class="n">sipec</span><span class="o">/</span><span class="n">sipec</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
</section>
<section id="own-pipline">
<h3>own pipline<a class="headerlink" href="#own-pipline" title="Permalink to this headline">¶</a></h3>
<p>You can build your own workflow by combining functions of the different
SIPEC modules. To do so, you usually need to define a config file, that
specifies parameters for the network and training to be used. Next, you
will need to load your data via the dataloader module. This enables you
to run the different SIPEC modules.</p>
</section>
</section>
<section id="annotation-of-data">
<h2>Annotation of Data<a class="headerlink" href="#annotation-of-data" title="Permalink to this headline">¶</a></h2>
<p>For the annotation of segmentation as well as behavioral data we
recommend the use of the VGG annotator, that can be found here:
<a class="reference external" href="http://www.robots.ox.ac.uk/~vgg/software/via/">http://www.robots.ox.ac.uk/~vgg/software/via/</a> For the annotation of
identification data we provide a GUI:
<a class="reference external" href="https://github.com/damaggu/idtracking_gui">https://github.com/damaggu/idtracking_gui</a></p>
</section>
<section id="example-data">
<h2>Example Data<a class="headerlink" href="#example-data" title="Permalink to this headline">¶</a></h2>
<p>For open field (OFT) mouse behavioral analysis, you can use the
exemplary data from Sturman et al. from zenedo.
<a class="reference external" href="https://zenodo.org/record/3608658">https://zenodo.org/record/3608658</a> The corresponding labels can be
accessed here.
<a class="reference external" href="https://github.com/ETHZ-INS/DLCAnalyzer/tree/master/data/OFT/Labels">https://github.com/ETHZ-INS/DLCAnalyzer/tree/master/data/OFT/Labels</a></p>
<p><a class="reference external" href="https://www.dropbox.com/sh/dpkswv0j3l3j38r/AABwHUdL6XYvrhDLDSlyPFzZa?dl=0">https://www.dropbox.com/sh/dpkswv0j3l3j38r/AABwHUdL6XYvrhDLDSlyPFzZa?dl=0</a></p>
<p><a class="reference external" href="https://www.dropbox.com/sh/y387kik9mwuszl3/AABBVWALEimW-hrbXvdfjHQSa?dl=0">https://www.dropbox.com/sh/y387kik9mwuszl3/AABBVWALEimW-hrbXvdfjHQSa?dl=0</a></p>
</section>
<section id="cite">
<h2>Cite<a class="headerlink" href="#cite" title="Permalink to this headline">¶</a></h2>
<p>If you use any part of this code for your work, please cite the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SIPEC</span><span class="p">:</span> <span class="n">the</span> <span class="n">deep</span><span class="o">-</span><span class="n">learning</span> <span class="n">Swiss</span> <span class="n">knife</span> <span class="k">for</span> <span class="n">behavioral</span> <span class="n">data</span> <span class="n">analysis</span>
<span class="n">Markus</span> <span class="n">Marks</span><span class="p">,</span> <span class="n">Jin</span> <span class="n">Qiuhan</span><span class="p">,</span> <span class="n">Oliver</span> <span class="n">Sturman</span><span class="p">,</span> <span class="n">Lukas</span> <span class="n">von</span> <span class="n">Ziegler</span><span class="p">,</span> <span class="n">Sepp</span> <span class="n">Kollmorgen</span><span class="p">,</span> <span class="n">Wolfger</span> <span class="n">von</span> <span class="n">der</span> <span class="n">Behrens</span><span class="p">,</span> <span class="n">Valerio</span> <span class="n">Mante</span><span class="p">,</span> <span class="n">Johannes</span> <span class="n">Bohacek</span><span class="p">,</span> <span class="n">Mehmet</span> <span class="n">Fatih</span> <span class="n">Yanik</span>
<span class="n">bioRxiv</span> <span class="mf">2020.10.26.355115</span><span class="p">;</span> <span class="n">doi</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">doi</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mf">10.1101</span><span class="o">/</span><span class="mf">2020.10.26.355115</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">SIPEC</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">SIPEC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#usage-installation">Usage/Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#annotation-of-data">Annotation of Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-data">Example Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cite">Cite</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="SwissKnife.html">SwissKnife package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../index.html" title="previous chapter">Welcome to SIPEC’s documentation!</a></li>
      <li>Next: <a href="SwissKnife.html" title="next chapter">SwissKnife package</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Dr Markus Marks.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/source/README.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>